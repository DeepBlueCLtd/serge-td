(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{102:function(e){e.exports={main:{name:"main",remote:null,live:!1,retry:!1},messages:{name:"messages",remote:"https://serge-td.herokuapp.com/db/messages",live:!0,retry:!1},"message-types":{name:"message-types",remote:null,live:!1,retry:!1}}},115:function(e,t,a){"use strict";a.r(t);var n=a(1),r=a.n(n),s=a(47),o=a.n(s),i=a(18),c=a(135),l=a(136),u=a(137),h=a(8),m=a(31),d=m.a.create({main:{padding:"15px 0"}}),p=a(134),g="PUSH_MESSAGES",f="REMOVE_ALL_MESSAGES",b="UPDATE_MESSAGES",v="SAVE_DRAFT",y="SEND_DRAFT_MESSAGE";function O(e){return{type:v,payload:{message:e}}}var j="ADD_CHAT",w="REMOVE_CHAT";var E,k=["height","color","weight"],S="name",I="table",C=a(9),T=a(17),M=a(14),D=a(12),x=a(3),F=a(13),A=a(117),_=a(118),R=a(119),N=a(120),V=a(121),B=a(122),G=a(123),W=a(124),H=a(72),U=a(48),P=a.n(U),q=a(55),Y=a.n(q),z=a(7),L={showOnGameControlCreateChats:!0,addChatIdToChatFromArray:!0,addChatIdToChatToArray:!0,preFillFrom:!1},J=[{chatId:"red",label:"Red Chat",options:Object(z.a)({},L)},{chatId:"blue",label:"Blue Chat",options:Object(z.a)({},L)},{chatId:"white",label:"White Chat",options:Object(z.a)({},L,{addChatIdToChatToArray:!1,preFillFrom:!0})}],K=function(){return J.filter(function(e){return e.options.showOnGameControlCreateChats})},X=J,$=m.a.create({main:{padding:"15px 0"},createMessage:{display:"none"},createMessageShow:{display:"block"}}),Q=function(e){function t(e,a){var n;return Object(C.a)(this,t),(n=Object(M.a)(this,Object(D.a)(t).call(this,e,a))).newMessageForm=n.newMessageForm.bind(Object(x.a)(n)),n.closeMessageForm=n.closeMessageForm.bind(Object(x.a)(n)),n.injectForm=n.injectForm.bind(Object(x.a)(n)),n.generateMessages=n.generateMessages.bind(Object(x.a)(n)),n.editor=null,n.editorRef=r.a.createRef(),n.state={activeSchema:null,createChats:K()},n}return Object(F.a)(t,e),Object(T.a)(t,[{key:"generateMessages",value:function(e){var t=this;this.props.createMessages(Array.apply(null,Array(e)).map(function(){var e=t.props.messageTypes[Math.floor(Math.random()*t.props.messageTypes.length)];return e.required.reduce(function(t,a){var n="",r=e.properties[a].enum;if(Array.isArray(r)&&r.length)n=r[Math.floor(Math.random()*r.length)];else if("color"===e.properties[a].format)n="#"+Math.floor(16777215*Math.random()).toString(16);else switch(e.properties[a].type){case"integer":n=Math.floor(999*Math.random());break;case"string":n=Y()({count:1});break;default:n=e.properties[a].default||Y()({count:1})}return t[a]=n,t},{})}))}},{key:"newMessageForm",value:function(e){if(this.state.activeSchema!==e.target.name){this.editor&&this.editor.destroy(),this.setState({activeSchema:e.target.name});var t=this.props.messageTypes[e.target.name];t.properties.from.enum=t.properties.from.enum.sort(function(e,t){return"white"===e?-1:"white"===t?1:0}),this.editor=new P.a(this.editorRef.current,{schema:t,theme:"bootstrap4"})}else this.closeMessageForm()}},{key:"closeMessageForm",value:function(){this.editor.destroy(),this.setState({activeSchema:null})}},{key:"injectForm",value:function(){this.editor.validate().length||(this.props.createMessages([this.editor.getValue()]),this.closeMessageForm())}},{key:"render",value:function(){var e=this;return r.a.createElement("div",{className:Object(h.css)($.main)},r.a.createElement(A.a,{className:"main"},r.a.createElement(_.a,{md:4},r.a.createElement(R.a,null,r.a.createElement(N.a,null,"Game Control"),r.a.createElement(V.a,null,r.a.createElement("p",null,"Inject Messages:"),r.a.createElement(B.a,null,this.props.messageTypes.map(function(t,a){return r.a.createElement(G.a,{key:a,tag:"button",active:a===parseInt(e.state.activeSchema),onClick:e.newMessageForm,name:a},t.title)}))),!!this.state.createChats.length&&r.a.createElement(V.a,null,r.a.createElement("p",null,"Create chats:"),r.a.createElement(B.a,null,this.state.createChats.map(function(t,a){var n=e.props.chats.includes(t.chatId);return r.a.createElement(G.a,{key:a,tag:"button",active:n,onClick:function(){n?e.props.removeChat(t.chatId):e.props.createChat(t)}},t.label)}))),r.a.createElement(W.a,null,r.a.createElement(H.a,{block:!0,color:"success",onClick:function(){e.generateMessages(50)}},"Generate 50 Messages"),r.a.createElement(H.a,{block:!0,color:"success",onClick:function(){e.generateMessages(100)}},"Generate 100 Messages"),r.a.createElement(H.a,{block:!0,color:"success",onClick:function(){e.generateMessages(1e3)}},"Generate 1000 Messages")),r.a.createElement(W.a,null,r.a.createElement(H.a,{block:!0,color:"danger",onClick:this.props.clearMessages},"Clear Messages")))),r.a.createElement(_.a,{md:8},r.a.createElement("div",{className:Object(h.css)($.createMessage,this.state.activeSchema&&$.createMessageShow)},r.a.createElement(R.a,null,r.a.createElement(V.a,null,r.a.createElement("div",{ref:this.editorRef})),r.a.createElement(W.a,null,r.a.createElement(H.a,{color:"success",onClick:this.injectForm},"Inject")))))))}}]),t}(n.Component),Z=Object(i.b)(function(e){return{messageTypes:e.messageTypes.filter(function(e){return k.includes(e.scheme)}),chats:e.chats.map(function(e){return e&&e.id})}},function(e){return{createMessages:function(t){e(function(e){return{type:g,payload:{messages:e}}}(t))},clearMessages:function(){e({type:f})},createChat:function(t){e(function(e){var t=e.chatId,a=e.label;return{type:j,payload:{chat:{id:t,label:a}}}}(t))},removeChat:function(t){e({type:w,payload:t})}}})(Q),ee=m.a.create({chatItem:{paddingBottom:"15px"}}),te=h.StyleSheet.create({main:{height:"320px",position:"relative",paddingTop:"0.1px",":after":{content:'""',display:"block",position:"absolute",width:"100%",height:"20px",top:"100%",background:"linear-gradient(to bottom, rgba(255,255,255,0) 0%,rgba(255,255,255,1) 100%)",left:"0"},":before":{content:'""',display:"block",position:"absolute",width:"100%",height:"20px",bottom:"100%",left:"0",zIndex:"2",background:"linear-gradient(to bottom, rgba(255,255,255,1) 0%,rgba(255,255,255,0) 100%)"}},container:{position:"absolute",maxHeight:"100%",height:"auto",left:"0",bottom:"0",width:"100%"},item:{display:"inline-block",verticalAligin:"top",maxWidth:"100%"},scrolContent:{padding:"20px"},badge:{maxWidth:"100%",fontSize:"16px",lineHeight:"20px",padding:"5px 15px",borderRadius:"15px 0 15px 15px",position:"relative",overflow:"hidden",display:"inline-block",verticalAligin:"top",opacity:"0.9",color:"#fff",":hover":{opacity:"1"}},badgeLeft:{borderRadius:"0 15px 15px 15px"},badgeBg:{opacity:"0.8",position:"absolute",left:"0",bottom:"0",height:"100%",width:"100%"},message:{position:"relative"},scrollbar:{boxSizing:"content-box",width:"100%",padding:"20px",margin:"-20px 0 0 -20px",position:"relative",height:"100%"}}),ae=a(73),ne=a.n(ae),re={blue:"bg-primary",gray:"bg-secondary",green:"bg-success",red:"bg-danger",yellow:"bg-warning",black:"bg-dark",white:"bg-white",lightBlue:"bg-info",lightGray:"bg-light",lightBlack:"bg-muted"},se={transparent:"link",blue:"primary",gray:"secondary",green:"success",red:"danger",yellow:"warning",lightBlue:"info"},oe={blue:"text-primary",gray:"text-secondary",green:"text-success",red:"text-danger",yellow:"text-warning",black:"text-dark",white:"text-white",lightBlue:"text-info",lightGray:"text-light",lightBlack:"text-muted"},ie=function(){function e(t){Object(C.a)(this,e),this.itemId=t,this.items={},this.itemDefault={},this.global={}}return Object(T.a)(e,[{key:"getGlobalScheme",value:function(){return this.global}},{key:"getItemScheme",value:function(){return Object(z.a)({},this.itemDefault,this.items[this.itemId]||{})}},{key:"getScheme",value:function(){return{item:this.getItemScheme(),global:this.getGlobalScheme()}}}]),e}(),ce=function(e){function t(e){var a;return Object(C.a)(this,t),(a=Object(M.a)(this,Object(D.a)(t).call(this,e))).items={red:{bg:re.red},blue:{bg:re.blue}},a.itemDefault={bg:re.gray,text:oe.white},a}return Object(F.a)(t,e),t}(ie),le=a(56),ue=a.n(le),he=function(e){function t(e,a){var r;return Object(C.a)(this,t),(r=Object(M.a)(this,Object(D.a)(t).call(this,e,a))).timeId=null,r.loadTimeId=null,r.loading=!1,r.scrolledDown=!0,r.scrollbar=Object(n.createRef)(),r.loadMoreCount=10,r.getScrollHeight=r.getScrollHeight.bind(Object(x.a)(r)),r.onScrollUp=r.onScrollUp.bind(Object(x.a)(r)),r.onYReachStart=r.onYReachStart.bind(Object(x.a)(r)),r.onYReachEnd=r.onYReachEnd.bind(Object(x.a)(r)),r.scrollToDown=r.scrollToDown.bind(Object(x.a)(r)),r.firstScrolled=!1,r.state={showItemsCount:10},r}return Object(F.a)(t,e),Object(T.a)(t,[{key:"componentWillUnmount",value:function(){clearTimeout(this.loadTimeId)}},{key:"onScrollUp",value:function(){this.scrolledDown=!1}},{key:"onYReachEnd",value:function(){this.scrolledDown=!0}},{key:"onYReachStart",value:function(){var e=this;this.loadTimeId&&clearTimeout(this.loadTimeId),this.loadTimeId=setTimeout(function(){var t=e.getScrollHeight();e.scrolledDown||e.loading||(e.loading=!0,e.setState({showItemsCount:e.state.showItemsCount+e.loadMoreCount}),setTimeout(function(){e.scrollbar.current&&(e.scrollbar.current._container.scrollTop=e.getScrollHeight()-t),e.loading=!1}))})}},{key:"getScrollHeight",value:function(){return this.scrollbar.current?this.scrollbar.current._container.scrollHeight:0}},{key:"scrollToDown",value:function(){var e=this;this.timeId&&clearTimeout(this.timeId),this.timeId=setTimeout(function(){e.scrollbar.current?(e.scrollbar.current._container.scrollTop=e.getScrollHeight(),e.firstScrolled=!0):e.firstScrolled||(e.timeId=setTimeout(function(){e.scrollToDown()},512))})}},{key:"componentWillReceiveProps",value:function(e){if(0!==this.props.messages.length&&e.messages.length>this.state.showItemsCount&&this.props.messages.length<e.messages.length){var t=e.messages.length-this.props.messages.length;this.setState({showItemsCount:this.state.showItemsCount+(t>this.loadMoreCount?this.loadMoreCount:t)})}this.scrollToDown()}},{key:"renderItem",value:function(e){if(!e)return"";var t=e.from===this.props.chatId,a=new ce(e.from).getItemScheme(),n={};return t&&(n={textAlign:"right"}),r.a.createElement("div",{style:n},r.a.createElement("div",{className:Object(h.css)(te.item)},r.a.createElement("div",{className:Object(h.css)(te.badge,!t&&te.badgeLeft)},r.a.createElement("div",{className:ue()(Object(h.css)(te.badgeBg),a.bg)}),r.a.createElement("div",{className:ue()(Object(h.css)(te.message),a.text)},Object.keys(e).map(function(t){return"_"!==t.charAt(0)&&e[t]&&r.a.createElement("div",{key:t},r.a.createElement("strong",null,t,":")," ",e[t])})))))}},{key:"render",value:function(){var e=this;return r.a.createElement("div",{className:Object(h.css)(te.main)},r.a.createElement("div",{className:Object(h.css)(te.scrollbar)},r.a.createElement(ne.a,{ref:this.scrollbar,onYReachEnd:this.onYReachEnd,onScrollUp:this.onScrollUp,onYReachStart:this.onYReachStart,suppressScrollX:!0,className:Object(h.css)(te.container),contentClassName:Object(h.css)(te.scrolContent)},r.a.createElement("div",{className:Object(h.css)(te.scrolContent)},this.props.messages.slice(Math.max(this.props.messages.length-this.state.showItemsCount,0)).map(function(t,a){return r.a.createElement("div",{key:a},e.renderItem(t.doc))})))))}}]),t}(n.Component),me=Object(i.b)(function(e,t){var a=t.chatId;return{messages:e.messages&&Array.isArray(e.messages[a])?e.messages[a]:[],chatId:a}},function(e){return{}})(he),de=a(6),pe=a.n(de),ge=function(e){function t(e){var a;return Object(C.a)(this,t),(a=Object(M.a)(this,Object(D.a)(t).call(this,e))).items={red:{bg:re.red,text:oe.white},blue:{bg:re.blue,text:oe.white}},a.itemDefault={bg:re.lightGray,text:oe.black,btn:se.gray},a.global={body:re.white,footer:re.light,tab:re.white,activeTab:pe()(re.blue,oe.white)},a}return Object(F.a)(t,e),t}(ie),fe=a(50),be=a(74);try{E=a(102)}catch(jt){E={}}E=Object(z.a)({},be,E);var ve=function(e,t,a){if(!E[e]&&!a)return new fe.a(e);a||(a={});var n=E[e]?Object(z.a)({},E[e],a):a,r=new fe.a(n.name||e);if(n.remote&&t){var s=new fe.a(n.remote);r.replicate.to(s,{live:n.live,retry:n.retry}).on("complete",function(e){console.log("complete",e)}),r.replicate.from(s,{live:n.live,retry:n.retry}).on("complete",function(e){console.log("complete from",e)})}return r},ye={};X.forEach(function(e){var t=e.chatId;ye[t]={map:function(e){("chatId"===e.to&&!1===e.draft||"chatId"===e.from)&&e.id}.toString().replace(new RegExp("chatId","g"),t)}});var Oe={messages:ye},je=function e(t,a,n){var r=a.split("/")[0];return t.query(a,n).catch(function(s){if(!Oe[r])throw new Error("View "+r+" is not defined.");if(404===s.status)return t.put({_id:"_design/"+r,views:Oe[r]}).then(function(){return e(t,a,n)})})},we={};X.forEach(function(e){var t=e.chatId;we[t]=function(e){return"chatId"===e.to&&!1===e.draft||"chatId"===e.from}.toString().replace(new RegExp("chatId","g"),t)});var Ee={messages:we},ke="filter",Se=function(e,t,a){return e.changes({since:"now",live:!0,include_docs:!0,filter:ke+t})},Ie=h.StyleSheet.create({label:{position:"absolute",top:0,right:0},labelContainer:{position:"relative",width:"100%"},labelButton:{paddingRight:"0 !important",paddingLeft:"0 !important"}}),Ce=function(e){var t=e.colorScheme,a=e.button,n=e.children,s=e.chatId,o=e.defaultMessageType,i=e.createDraft;return r.a.createElement(N.a,{className:t.item.bg},r.a.createElement("div",{className:Object(h.css)(Ie.labelContainer)},r.a.createElement("div",{className:Object(h.css)(Ie.label)},r.a.createElement(H.a,{color:"link",className:Object(h.css)(Ie.labelButton)},r.a.createElement("strong",{className:t.item.text},n)))),a&&o&&r.a.createElement(H.a,{color:t.item.btn,onClick:function(){var e={};o.required.forEach(function(t){var a="",n=o.properties[t].enum;Array.isArray(n)&&n.length?a="from"===t&&n.includes(s)?s:o.properties[t].default?o.properties[t].default:n[0]:o.properties[t].default&&(a=o.properties[t].default),e[t]=a}),i(e)}},a))};Ce.defaultValues={button:"",children:""};var Te=Ce,Me=Object(i.b)(function(e){return{defaultMessageType:e.messageTypes.find(function(e){return e.scheme===S})}},function(e){return{createDraft:function(t){e(O(t))}}})(Te),De=a(125),xe=a(126),Fe=a(127),Ae=a(128),_e=a(129),Re=a(130),Ne=a(131),Ve=a(132),Be=a(133),Ge=a(27),We=a(30),He=function(e){function t(e,a){var n;return Object(C.a)(this,t),(n=Object(M.a)(this,Object(D.a)(t).call(this,e,a))).initForm=n.initForm.bind(Object(x.a)(n)),n.submitForm=n.submitForm.bind(Object(x.a)(n)),n.getFormFilteredData=n.getFormFilteredData.bind(Object(x.a)(n)),n.editor=null,n.editorBox=r.a.createRef(),n.hiddenAutofillKeys=["draft","_id","_rev","from","test"],n}return Object(F.a)(t,e),Object(T.a)(t,[{key:"componentDidMount",value:function(){this.initForm()}},{key:"componentWillReceiveProps",value:function(e){this.editor&&this.editor.setValue(this.getFormFilteredData(e.form,e.message).values)}},{key:"getFormFilteredData",value:function(e,t){var a=Object(z.a)({},e,{required:["_id"].concat(Object(We.a)(e.required)),properties:Object(z.a)({},e.properties)}),n=Object(z.a)({},t);return this.hiddenAutofillKeys.forEach(function(e){var t=a.required.indexOf(e);t>-1&&a.required.splice(t,1),a.properties[e]&&delete a.properties[e],n[e]&&delete n[e]}),{form:a,values:n}}},{key:"initForm",value:function(){var e=this,t=this.getFormFilteredData(this.props.form,this.props.message);this.editor=new P.a(this.editorBox.current,{schema:t.form,theme:"bootstrap4"}).setValue(t.values);var a=function(t){e.editor.editors.hasOwnProperty(t)&&"root"!==t&&e.editor.watch(t,function(a){e.props.saveDraft(Object(z.a)({},e.props.message,e.editor.getValue(),Object(Ge.a)({},t.replace("root.",""),e.editor.getEditor(t).getValue())))})};for(var n in this.editor.editors)a(n)}},{key:"submitForm",value:function(){this.editor.validate().length||this.props.sendDraftMessage(Object(z.a)({},this.props.message,this.editor.getValue()))}},{key:"render",value:function(){return r.a.createElement("div",{className:"messageEdit"},r.a.createElement("div",{ref:this.editorBox}),r.a.createElement(H.a,{onClick:this.submitForm},this.props.button))}}]),t}(n.Component),Ue=function(e){function t(e,a){var n;return Object(C.a)(this,t),(n=Object(M.a)(this,Object(D.a)(t).call(this,e,a))).renderDropdown=n.renderDropdown.bind(Object(x.a)(n)),n.toggle=n.toggle.bind(Object(x.a)(n)),n.toggleDropdown=n.toggleDropdown.bind(Object(x.a)(n)),n.renderTabs=n.renderTabs.bind(Object(x.a)(n)),n.showDropdownAfter=3,n.state={activeDraft:e.messages.length-1,dropdownOpen:!1},n}return Object(F.a)(t,e),Object(T.a)(t,[{key:"componentWillReceiveProps",value:function(e){this.props.messages.length!==e.messages.length&&this.toggle(e.messages.length-1)}},{key:"toggle",value:function(e){this.setState({activeDraft:e})}},{key:"toggleDropdown",value:function(){this.setState({dropdownOpen:!this.state.dropdownOpen})}},{key:"renderDropdown",value:function(){var e=this;return r.a.createElement(De.a,{isOpen:this.state.dropdownOpen,toggle:this.toggleDropdown},r.a.createElement(xe.a,{caret:!0,className:this.props.colorScheme.global.activeTab},this.props.messages[this.state.activeDraft].doc.title||"Draft ".concat(this.state.activeDraft)),r.a.createElement(Fe.a,{right:!0},this.props.messages.map(function(t,a){return r.a.createElement(Ae.a,{key:a,className:e.state.activeDraft===a?e.props.colorScheme.global.activeTab:"",onClick:function(){e.toggle(a)}},t.doc.title||"Draft ".concat(a))})))}},{key:"renderTabs",value:function(){var e=this;return this.props.messages.length<2?r.a.createElement("div",null):r.a.createElement(_e.a,{tabs:!0},this.props.messages.map(function(t,a){return r.a.createElement(Re.a,{key:a},r.a.createElement(Ne.a,{className:e.state.activeDraft===a?e.props.colorScheme.global.activeTab:e.props.colorScheme.global.tab,onClick:function(){e.toggle(a)}},t.doc.title?t.doc.title:"Draft ".concat(a+1)))}))}},{key:"render",value:function(){var e=this;return r.a.createElement(W.a,{className:this.props.colorScheme.global.footer},this.props.messages.length>0&&r.a.createElement(Ve.a,{activeTab:this.state.activeDraft+""},this.props.messages.length>this.showDropdownAfter?this.renderDropdown():this.renderTabs(),this.props.messages.map(function(t,a){return r.a.createElement(Be.a,{key:a,tabId:a+""},r.a.createElement(He,{message:t.doc,button:e.props.button,form:e.props.form,saveDraft:e.props.saveDraft,sendDraftMessage:e.props.sendDraftMessage}))})))}}]),t}(n.Component),Pe=Object(i.b)(function(e,t){var a=t.chatId;return{messages:e.messages&&Array.isArray(e.messages[a])?e.messages[a].filter(function(e){return e.doc.draft}):[],form:Object(z.a)({},e.messageTypes.find(function(e){return e.scheme===S}),{format:I})}},function(e){return{sendDraftMessage:function(t){e({type:y,payload:{message:t}})},saveDraft:function(t){e(O(t))}}})(Ue),qe=function(e){function t(e,a){var n;return Object(C.a)(this,t),(n=Object(M.a)(this,Object(D.a)(t).call(this,e,a))).updateState=function(e){n.changeTimer&&clearTimeout(n.changeTimer),n.changeTimer=setTimeout(function(){je(n.db,"messages/"+n.props.chatId,{include_docs:!0,filter:ke+"messages/"+n.props.chatId}).then(function(t){var a=t.rows;n.props.updateMessages(a||[],n.props.chatId),"function"===typeof e&&e()})},n.changeTime)},n.changeTimer=null,n.changeTime=128,n.updateState=n.updateState.bind(Object(x.a)(n)),n.db=ve("messages"),n.changes=Se(n.db,"messages/"+e.chatId),n.state={colorScheme:new ge(e.chatId).getScheme()},n}return Object(F.a)(t,e),Object(T.a)(t,[{key:"componentWillMount",value:function(){var e=this;this.updateState(function(){e.changes.on("change",function(){e.updateState()})})}},{key:"componentWillReceiveProps",value:function(e){var t=this;this.props.chatId!==e.chatId&&(this.changes.cancel(),clearTimeout(this.changeTimer),this.changes=Se(this.db,"messages/"+e.chatId).on("change",function(){t.updateState()}),this.setState({colorScheme:new ge(e.chatId).getScheme()}))}},{key:"componentWillUnmount",value:function(){this.changes.cancel(),clearTimeout(this.changeTimer)}},{key:"render",value:function(){return r.a.createElement(R.a,null,r.a.createElement(Me,{colorScheme:this.state.colorScheme,button:"Add >>",chatId:this.props.chatId},this.props.label),r.a.createElement(V.a,{className:this.state.colorScheme.global.body},r.a.createElement(me,{chatId:this.props.chatId})),r.a.createElement(Pe,{colorScheme:this.state.colorScheme,button:"Send",chatId:this.props.chatId}))}}]),t}(n.Component),Ye=Object(i.b)(function(e){return{}},function(e){return{updateMessages:function(t,a){e(function(e,t){return{type:b,payload:{messages:e,chatId:t}}}(t,a))}}})(qe),ze=12,Le=6,Je=4,Ke=function(e){var t=e.chats,a=e.form;return r.a.createElement(A.a,null,t.map(function(e,t){return e&&r.a.createElement(_.a,{xs:ze,sm:Le,md:Je,key:t},r.a.createElement("div",{className:Object(h.css)(ee.chatItem)},r.a.createElement(Ye,{chatId:e.id,label:e.label,form:a})))}))},Xe=Object(i.b)(function(e){return{chats:e.chats,form:Object(z.a)({},e.messageTypes.find(function(e){return e.scheme===S}),{format:I})}},function(e){return{}})(Ke),$e=function(){return r.a.createElement(p.a,{fluid:!0},r.a.createElement("div",{className:Object(h.css)(d.main)},r.a.createElement(Xe,null),r.a.createElement(Z,null)))},Qe=function(e){function t(e,a){var n;return Object(C.a)(this,t),(n=Object(M.a)(this,Object(D.a)(t).call(this,e,a))).check=n.check.bind(Object(x.a)(n)),n.messagesFiltersInitialized=!1,n.messagesViewsInitialized=!1,n.state={done:!1},n}return Object(F.a)(t,e),Object(T.a)(t,[{key:"check",value:function(){this.messagesFiltersInitialized&&this.messagesViewsInitialized&&this.setState({done:!0})}},{key:"componentWillMount",value:function(){this.checkMessages()}},{key:"checkMessages",value:function(){this.checkFilter(Ee,ke,Object.keys(Ee)),this.checkView(Oe,Object.keys(Oe))}},{key:"checkFilter",value:function(e,t,a,n){var r=this;if(n||(n=0),!a.length||a.length<=n)return this.messagesFiltersInitialized=!0,this.check(),!1;var s=ve(a[n],!1,{live:!1}),o="_design/"+t+a[n];s.get(o).then(function(i){var c=!0;i.filters?Object.keys(e[a[n]]).forEach(function(t){i.filters[a[n]]&&e[a[n]][t]===i.filters[t]||(c=!1)}):c=!1,c?r.checkFilter(e,t,a,n+1):(console.log("Updateing Filters ".concat(o)),s.put(Object(z.a)({},i,{filters:e[a[n]]})).then(function(){console.log("Updateing Filters ".concat(o," (success)")),r.checkFilter(e,t,a,n+1)}))}).catch(function(i){404===i.status&&(console.log("Creating Filters ".concat(o)),s.put({_id:o,filters:e[a[n]]}).then(function(){console.log("Creating Filters ".concat(o," (success)")),r.checkFilter(e,t,a,n+1)}))})}},{key:"checkView",value:function(e,t,a){var n=this;if(a||(a=0),!t.length||t.length<=a)return this.messagesViewsInitialized=!0,this.check(),!1;var r="_design/"+t[a],s=ve(t[a],!1,{live:!1});s.get(r).then(function(o){var i=!0;o.views?Object.keys(e[t[a]]).forEach(function(n){o.views[t[a]]&&e[t[a]][n].map===o.views[n].map||(i=!1)}):i=!1,i?n.checkView(e,t,a+1):(console.log("Updateing Views ".concat(r)),s.put(Object(z.a)({},o,{views:e[t[a]]})).then(function(){console.log("Updateing Views ".concat(r," (success)")),n.checkView(e,t,a+1)}))}).catch(function(o){var i=o.status;console.log("test",i),404===i&&(console.log("Creating Views ".concat(r)),s.put({_id:r,views:e[t[a]]}).then(function(){console.log("Views Filters ".concat(r," (success)")),n.checkView(e,t,a+1)}))})}},{key:"render",value:function(){return r.a.createElement("div",null,this.state.done&&this.props.children)}}]),t}(n.Component),Ze=function(e){var t=e.store;return r.a.createElement(i.a,{store:t},r.a.createElement(Qe,null,r.a.createElement(c.a,null,r.a.createElement(l.a,null,r.a.createElement(u.a,{exact:!0,path:"/",component:$e})))))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));a(104),a(105),a(106);var et=a(23),tt=a(28),at=[],nt=ve("chats"),rt=Object(tt.persistentReducer)(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:at,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case j:return[].concat(Object(We.a)(e),[t.payload.chat]);case w:return e.filter(function(e){return e.id!==t.payload});default:return e}},{db:nt,name:"chats"}),st={type:"object",format:"grid",required:["from","to","title"],properties:{from:{type:"string",enum:J.filter(function(e){return e.options.addChatIdToChatFromArray}).map(function(e){return e.chatId})},to:{type:"string",enum:J.filter(function(e){return e.options.addChatIdToChatToArray}).map(function(e){return e.chatId})},title:{type:"string",description:"Title for this message"}}},ot=[{scheme:"height",title:"PersonHeight",properties:{height:{type:"integer",default:12}}},{scheme:"weight",title:"PersonWeight",properties:{weight:{type:"integer",default:12}}},{scheme:"color",title:"PersonColor",properties:{color:{type:"string",format:"color"}}},{scheme:"name",title:"PersonName",properties:{name:{type:"string",format:"string"}}}],it=function(){return ot.map(function(e){return Object(z.a)({},st,{scheme:e.scheme,title:e.title,properties:Object(z.a)({},st.properties,e.properties),required:[].concat(Object(We.a)(st.required),[e.scheme])})})}(),ct=ve("message-types"),lt=Object(tt.persistentReducer)(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:it;return(arguments.length>1?arguments[1]:void 0).type,e},{db:ct,name:"message-types"}),ut=ve("messages",!0),ht={},mt=function(e){return(new Date).toISOString()+"-"+(e||"0")},dt=function(e){return e.map(function(e,t){return Object(z.a)({},e,{_id:mt(t),draft:!1})})},pt=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ht,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case g:var a=dt(t.payload.messages);return 1===a.length?ut.put(a[0]):ut.bulkDocs(a),e;case f:return ut.allDocs().then(function(e){return Promise.all(e.rows.map(function(e){return-1===e.id.search("_design")&&ut.remove(e.id,e.value.rev)}))}),{};case b:return Object(z.a)({},e,Object(Ge.a)({},t.payload.chatId,t.payload.messages));case v:var n=Object(z.a)({},dt([t.payload.message])[0],{draft:!0});return t.payload.message._id&&(n._id=t.payload.message._id),t.payload.message._rev&&(n._rev=t.payload.message._rev),ut.put(n),e;case y:return ut.get(t.payload.message._id).then(function(e){ut.bulkDocs([Object(z.a)({},dt([t.payload.message])[0],{_rev:""}),Object(z.a)({},e,{_deleted:!0})])}),e;default:return e}},gt=Object(et.combineReducers)({chats:rt,messageTypes:lt,messages:pt}),ft=a(77),bt=a(78),vt=Object(et.applyMiddleware)(ft.a),yt=ve("main"),Ot=Object(bt.composeWithDevTools)(vt,Object(tt.persistentStore)({db:yt}))(et.createStore)(gt);o.a.render(r.a.createElement(Ze,{store:Ot}),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})},74:function(e){e.exports={main:{name:"main",remote:null,live:!1,retry:!1},messages:{name:"messages",remote:"https://serge-td.herokuapp.com/db/messages",live:!0,retry:!1},"message-types":{name:"message-types",remote:null,live:!1,retry:!1}}},79:function(e,t,a){e.exports=a(115)}},[[79,1,2]]]);
//# sourceMappingURL=main.a49dc1d0.chunk.js.map